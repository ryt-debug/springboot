<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.springboot.mapper.ReserveMapper">
    <select id="AvailableRoom" resultType="int">
        select Id
        from pianoroom
        where Id not in(
            select pr.Id
            from pianoroom pr
                join reserve r on r.RoomId = pr.Id and r.Status in (2, 3)
            where (r.ReserveEndTime > #{StartTime})
               or (r.ReserveStartTime &lt; #{EndTime})
               or (r.ReserveStartTime &lt;= #{StartTime} and r.ReserveEndTime >= #{EndTime})
        )
    </select>

   <insert id="CreateReserve">
       insert into reserve(ReserveStartTime, ReserveEndTime, SubmitTime, StudentId, Status, RoomId)
       values(#{StartTime}, #{EndTime}, #{SubmitTime}, ${StudentId}, 2, ${RoomId})
   </insert>
</mapper>